name: Deployment pipeline

on:
  push:
    branches:
      - main

jobs:
    simple_deployment_pipeline:
        runs-on: ubuntu-20.04
        steps:
          - uses: actions/checkout@v4
          - uses: actions/setup-node@v4
            with:
                node-version: 18
          - name: Install dependencies
            run: npm ci
          - name: Check style
            run: npm run eslint
          - name: Build
            run: npm run build
          - name: test
            run: npm run test
          - name: e2e tests
            uses: cypress-io/github-action@v5
            with:
              command: npm run test:e2e
              start: npm run start-test
              wait-on: http://localhost:5000
          - name: Deploy to production
            uses: JorgeLNJunior/render-deploy@v1.4.3
            with:
              service_id: ${{ secrets.RENDER_SERVICE_ID }}
              api_key: ${{ secrets.RENDER_API_KEY }}
              github_deployment: true
              github_token: ${{ secrets.GITHUB_TOKEN }}